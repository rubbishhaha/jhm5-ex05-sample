<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HKDSE Results Analyzer</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .chart-container {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .filters {
            margin-bottom: 20px;
            padding: 20px;
            background-color: #f5f5f5;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <h1>HKDSE Results Analysis</h1>
    
    <div class="filters">
        <select id="viewType">
            <option value="number">View by Numbers</option>
            <option value="percentage">View by Percentage</option>
        </select>
        <select id="candidateType">
            <option value="day">Day School Candidates</option>
            <option value="all">All Candidates</option>
        </select>
    </div>

    <div class="chart-container">
        <canvas id="gradeDistribution"></canvas>
    </div>

    <div class="chart-container">
        <canvas id="cumulativeDistribution"></canvas>
    </div>

    <script>
        // Initialize charts
        const gradeCtx = document.getElementById('gradeDistribution').getContext('2d');
        const cumulativeCtx = document.getElementById('cumulativeDistribution').getContext('2d');
        let gradeChart, cumulativeChart;

        // Sample data structure (will be replaced with D1 data)
        const data = {
            labels: ['35/34/33', '32/31/30', '29/28/27', '26/25/24', '23/22/21', '20/19/18', '17/16/15', '14/13/12'],
            daySchool: {
                numbers: [283, 643, 1253, 2138, 3648, 4887, 4011, 1164],
                percentages: [0.7, 1.6, 3.1, 5.3, 9.0, 12.0, 9.9, 2.9]
            },
            allCandidates: {
                numbers: [296, 671, 1306, 2256, 3801, 5109, 4187, 1224],
                percentages: [0.6, 1.4, 2.7, 4.6, 7.8, 10.4, 8.5, 2.5]
            }
        };

        function updateCharts() {
            const viewType = document.getElementById('viewType').value;
            const candidateType = document.getElementById('candidateType').value;
            
            const dataset = candidateType === 'day' ? data.daySchool : data.allCandidates;
            const values = viewType === 'number' ? dataset.numbers : dataset.percentages;

            if (gradeChart) gradeChart.destroy();
            if (cumulativeChart) cumulativeChart.destroy();

            // Grade Distribution Chart
            gradeChart = new Chart(gradeCtx, {
                type: 'bar',
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: 'Grade Distribution',
                        data: values,
                        backgroundColor: 'rgba(54, 162, 235, 0.5)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: viewType === 'number' ? 'Number of Students' : 'Percentage (%)'
                            }
                        }
                    }
                }
            });

            // Cumulative Distribution Chart
            const cumulativeData = values.reduce((acc, curr, idx) => {
                acc.push((acc[idx - 1] || 0) + curr);
                return acc;
            }, []);

            cumulativeChart = new Chart(cumulativeCtx, {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: 'Cumulative Distribution',
                        data: cumulativeData,
                        borderColor: 'rgba(255, 99, 132, 1)',
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: viewType === 'number' ? 'Cumulative Number' : 'Cumulative Percentage (%)'
                            }
                        }
                    }
                }
            });
        }

        // Event listeners for filters
        document.getElementById('viewType').addEventListener('change', updateCharts);
        document.getElementById('candidateType').addEventListener('change', updateCharts);

        // Initial chart render
        updateCharts();
    </script>
</body>
</html>